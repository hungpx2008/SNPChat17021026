"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.evaluate = void 0;
const antlr4ts_1 = require("antlr4ts");
const error_listener_1 = require("./error.listener");
const Formula_1 = require("./parser/Formula");
const FormulaLexer_1 = require("./parser/FormulaLexer");
const visitor_1 = require("./visitor");
const evaluate = (input, dependFieldMap, record, timeZone) => {
    const inputStream = antlr4ts_1.CharStreams.fromString(input);
    const lexer = new FormulaLexer_1.FormulaLexer(inputStream);
    const tokenStream = new antlr4ts_1.CommonTokenStream(lexer);
    const parser = new Formula_1.Formula(tokenStream);
    parser.removeErrorListeners();
    const errorListener = new error_listener_1.FormulaErrorListener();
    parser.addErrorListener(errorListener);
    const tree = parser.root();
    const visitor = new visitor_1.EvalVisitor(dependFieldMap, record, timeZone);
    return visitor.visit(tree);
};
exports.evaluate = evaluate;
